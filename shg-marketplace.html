<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SHG Marketplace - Bazaar Odisha</title>
    <link rel="icon" type="image/webp" href="images/favicon.webp" />

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+Oriya:wght@400;700&display=swap"
      rel="stylesheet"
    />

    <style>
      :root {
        --primary-color: #0f766e;
        --primary-hover: #115e59;
        --success-color: #16a34a;
        --dark-text: #1f2937;
        --light-text: #f9fafb;
        --body-bg: #f9fafb;
      }
      body {
        font-family: "Poppins", sans-serif;
        background-color: var(--body-bg);
        color: var(--dark-text);
      }
      .font-odia {
        font-family: "Noto Sans Oriya", sans-serif;
      }
      .btn-primary {
        background-color: var(--primary-color);
        color: var(--light-text);
        transition: background-color 0.3s;
      }
      .btn-primary:hover {
        background-color: var(--primary-hover);
      }
      .cart-badge {
        position: absolute;
        top: -8px;
        right: -12px;
        height: 20px;
        width: 20px;
        background-color: var(--success-color);
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: 600;
        transform: scale(0);
        transition: transform 0.2s ease-in-out;
      }
      .cart-badge.active {
        transform: scale(1);
      }
      .form-input {
        width: 100%;
        border: 1px solid #d1d5db;
        border-radius: 0.5rem;
        padding: 0.75rem 1rem;
        transition: border-color 0.2s, box-shadow 0.2s;
      }
      .form-input:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 2px rgba(13, 148, 136, 0.2);
      }
      .product-image-container {
        position: relative;
        overflow: hidden;
        background-color: #e5e7eb;
      }
      .product-image-container .product-image {
        transition: transform 0.35s ease, filter 0.35s ease;
      }
      .product-image-container:hover .product-image {
        transform: scale(1.1);
        filter: brightness(40%);
      }
      .product-image-container .description-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        color: white;
        opacity: 0;
        transition: opacity 0.35s ease;
        padding: 1rem;
        pointer-events: none;
      }
      .product-image-container:hover .description-overlay {
        opacity: 1;
      }
      /* Chatbot Styles */
      #chat-widget {
        position: fixed;
        bottom: 20px;
        right: 20px;
        z-index: 1000;
      }
      #chat-button {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s;
        cursor: pointer;
      }
      #chat-button:hover {
        transform: scale(1.1);
      }
      #chat-window {
        position: fixed;
        bottom: 90px;
        right: 20px;
        width: 350px;
        max-width: 90vw;
        height: 500px;
        max-height: 70vh;
        background-color: white;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        transform: translateY(20px) scale(0.95);
        opacity: 0;
        transition: transform 0.3s ease, opacity 0.3s ease;
        pointer-events: none;
      }
      #chat-window.open {
        transform: translateY(0) scale(1);
        opacity: 1;
        pointer-events: auto;
      }
      #chat-close-button {
        font-size: 24px;
        line-height: 1;
        font-weight: bold;
      }
    </style>
  </head>
  <body class="bg-gray-100">
    <!-- Header Section -->
    <header class="bg-white shadow-md sticky top-0 z-50">
      <nav
        class="container mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center py-3"
      >
        <!-- Logo and Brand Name -->
        <a href="index.html" class="flex items-center gap-3">
          <img src="images/logo.webp" alt="Bazaar Odisha Logo" class="h-10" />
          <span
            class="font-bold text-2xl text-gray-800 tracking-tight hidden sm:block"
            >Bazaar Odisha</span
          >
        </a>

        <!-- Desktop Navigation Links -->
        <div class="hidden lg:flex items-center space-x-8">
          <!-- NOTE: Move the active classes to the link that matches the current page -->
          <a
            href="index.html"
            class="text-[var(--primary-color)] font-semibold border-b-2 border-[var(--primary-color)] pb-1"
            >Home</a
          >
          <a
            href="shg-marketplace.html"
            class="text-gray-700 hover:text-[var(--primary-color)] font-medium"
            >SHG Marketplace</a
          >
          <a
            href="hire-local-help.html"
            class="text-gray-700 hover:text-[var(--primary-color)] font-medium"
            >Hire Local Help</a
          >
          <a
            href="community-hub.html"
            class="text-gray-700 hover:text-[var(--primary-color)] font-medium"
            >Community</a
          >
        </div>

        <!-- Right Side Actions -->
        <div class="hidden lg:flex items-center space-x-4">
          <a href="cart.html" class="relative">
            <img src="images/cart-icon.webp" alt="Cart" class="h-6 w-6" />
            <span id="cart-badge" class="cart-badge">0</span>
          </a>
          <a
            href="add-listing.html"
            class="btn-primary font-semibold px-5 py-2 rounded-full text-sm"
            >Add Your Business</a
          >
        </div>

        <!-- Mobile Menu Button -->
        <div class="lg:hidden">
          <button
            id="mobile-menu-button"
            class="text-gray-600 focus:outline-none"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              ></path>
            </svg>
          </button>
        </div>
      </nav>

      <!-- Mobile Menu Panel (Hidden by default) -->
      <div id="mobile-menu" class="hidden lg:hidden px-4 pb-4">
        <a
          href="index.html"
          class="block py-2 px-2 rounded-md hover:bg-gray-100 font-semibold text-[var(--primary-color)]"
          >Home</a
        >
        <a
          href="shg-marketplace.html"
          class="block py-2 px-2 rounded-md hover:bg-gray-100"
          >SHG Marketplace</a
        >
        <a
          href="hire-local-help.html"
          class="block py-2 px-2 rounded-md hover:bg-gray-100"
          >Hire Local Help</a
        >
        <a
          href="community-hub.html"
          class="block py-2 px-2 rounded-md hover:bg-gray-100"
          >Community</a
        >
        <a href="cart.html" class="block py-2 px-2 rounded-md hover:bg-gray-100"
          >My Cart</a
        >
        <a
          href="add-listing.html"
          class="block mt-2 text-center w-full btn-primary font-semibold px-5 py-2 rounded-full text-sm"
          >Add Business</a
        >
      </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold">SHG Marketplace</h1>
        <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">
          Discover authentic, handmade products from the talented women of
          Odisha's Self-Help Groups. Every purchase empowers a local artisan.
        </p>
      </div>

      <!-- Mobile Filter Button -->
      <div class="lg:hidden mb-6">
        <button
          id="show-filters-btn"
          class="w-full flex items-center justify-center gap-2 btn-primary font-semibold py-3 px-4 rounded-lg"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="h-5 w-5"
            viewBox="0 0 20 20"
            fill="currentColor"
          >
            <path
              d="M5 4a1 1 0 00-2 0v7.268a2 2 0 000 3.464V16a1 1 0 102 0v-1.268a2 2 0 000-3.464V4zM11 4a1 1 0 10-2 0v1.268a2 2 0 000 3.464V16a1 1 0 102 0V8.732a2 2 0 000-3.464V4zM16 3a1 1 0 011 1v7.268a2 2 0 010 3.464V16a1 1 0 11-2 0v-1.268a2 2 0 010-3.464V4a1 1 0 011-1z"
            />
          </svg>
          Show Product Filters
        </button>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">
        <!-- Filters Sidebar -->
        <aside
          id="filters-sidebar"
          class="hidden lg:block lg:col-span-1 bg-white p-6 rounded-2xl shadow-lg lg:sticky lg:top-28"
        >
          <div class="flex justify-between items-center mb-4 border-b pb-2">
            <h2 class="text-2xl font-bold">Filters</h2>
            <button class="lg:hidden text-2xl font-bold" id="close-filters-btn">
              &times;
            </button>
          </div>
          <form id="filters-form" class="space-y-6">
            <div>
              <label for="search-input" class="font-semibold block mb-2"
                >Search Products</label
              ><input
                type="text"
                id="search-input"
                class="form-input"
                placeholder="e.g., pickle, saree"
              />
            </div>
            <div id="category-filters"></div>
            <div>
              <label for="price-range" class="font-semibold block mb-2"
                >Max Price:
                <span
                  id="price-value"
                  class="text-[var(--primary-color)] font-bold"
                ></span></label
              ><input
                type="range"
                id="price-range"
                min="0"
                max="5000"
                step="50"
                class="w-full"
              />
            </div>
            <div class="flex flex-col gap-3 pt-4 border-t">
              <button
                type="submit"
                class="btn-primary font-semibold py-2 px-4 rounded-lg w-full"
              >
                Apply Filters</button
              ><button
                type="button"
                id="clear-filters-btn"
                class="bg-gray-200 text-gray-700 font-semibold py-2 px-4 rounded-lg w-full hover:bg-gray-300"
              >
                Clear Filters
              </button>
            </div>
          </form>
        </aside>

        <!-- Product Grid -->
        <div id="results-container" class="lg:col-span-3">
          <div
            id="product-grid"
            class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-8"
          ></div>
          <div
            id="no-products-message"
            class="hidden text-center py-16 bg-white rounded-2xl shadow-lg"
          >
            <h2 class="text-3xl font-bold">No Products Found</h2>
            <p class="text-gray-600 mt-2 max-w-lg mx-auto">
              We couldn't find any products matching your filters. Please try
              adjusting them or clear to start over.
            </p>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8">
          <!-- Branding Section -->
          <div class="lg:col-span-1">
            <a href="index.html" class="flex items-center gap-3 mb-4">
              <img
                src="images/logo-white.webp"
                alt="Bazaar Odisha Logo"
                class="h-10"
              />
              <span class="font-bold text-xl text-white tracking-tight"
                >Bazaar Odisha</span
              >
            </a>
            <p class="text-sm text-gray-400 mt-2">
              Empowering Odisha's local economy, one click at a time.
            </p>
          </div>

          <!-- Quick Links -->
          <div>
            <h4 class="font-semibold text-white tracking-wider uppercase">
              Quick Links
            </h4>
            <ul class="mt-4 space-y-2">
              <li>
                <a href="about.html" class="hover:text-white transition-colors"
                  >About Us</a
                >
              </li>
              <li>
                <a
                  href="shg-marketplace.html"
                  class="hover:text-white transition-colors"
                  >SHG Marketplace</a
                >
              </li>
              <li>
                <a
                  href="hire-local-help.html"
                  class="hover:text-white transition-colors"
                  >Hire Local Help</a
                >
              </li>
              <li>
                <a
                  href="community-hub.html"
                  class="hover:text-white transition-colors"
                  >Community Hub</a
                >
              </li>
            </ul>
          </div>

          <!-- Support Links -->
          <div>
            <h4 class="font-semibold text-white tracking-wider uppercase">
              Support
            </h4>
            <ul class="mt-4 space-y-2">
              <li>
                <a href="faq.html" class="hover:text-white transition-colors"
                  >FAQ</a
                >
              </li>
              <li>
                <a
                  href="contact.html"
                  class="hover:text-white transition-colors"
                  >Contact Us</a
                >
              </li>
              <li>
                <a
                  href="privacy-policy.html"
                  class="hover:text-white transition-colors"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a
                  href="terms-of-service.html"
                  class="hover:text-white transition-colors"
                  >Terms of Service</a
                >
              </li>
            </ul>
          </div>

          <!-- For Partners -->
          <div>
            <h4 class="font-semibold text-white tracking-wider uppercase">
              For Partners
            </h4>
            <ul class="mt-4 space-y-2">
              <li>
                <a
                  href="add-listing.html"
                  class="hover:text-white transition-colors"
                  >List Your Business</a
                >
              </li>
              <li>
                <a
                  href="admin-login.html"
                  class="hover:text-white transition-colors"
                  >Admin Dashboard</a
                >
              </li>
            </ul>
          </div>
        </div>

        <!-- Copyright -->
        <div
          class="mt-8 pt-8 border-t border-gray-700 text-center text-sm text-gray-400"
        >
          <p>&copy; 2025 Bazaar Odisha. A Project by Aakash Khamari.</p>
        </div>
      </div>
    </footer>

    <!-- Chatbot Widget UI -->
    <style>
      /* New, more reliable CSS for chatbot visibility */
      #chat-window {
        transform: scale(0.95) translateY(10px);
        opacity: 0;
        pointer-events: none;
        transition: transform 0.3s ease-out, opacity 0.3s ease-out;
      }
      #chat-window.is-open {
        transform: scale(1) translateY(0);
        opacity: 1;
        pointer-events: auto;
      }
    </style>
    <div id="chat-widget">
      <!-- Chat Window -->
      <div
        id="chat-window"
        class="fixed bottom-24 right-5 w-[350px] max-w-[90vw] h-[500px] max-h-[70vh] bg-white rounded-xl shadow-2xl flex flex-col"
      >
        <header
          class="bg-gray-800 text-white p-4 rounded-t-xl flex items-center justify-between shadow-md flex-shrink-0"
        >
          <div class="flex items-center gap-3">
            <img
              src="images/logo-white.webp"
              class="h-8 w-8"
              alt="Mo Sahayak"
            />
            <div>
              <h3 class="font-bold text-lg">Mo Sahayak</h3>
              <p
                class="font-odia text-xs opacity-80"
                style="font-family: 'Noto Sans Oriya', sans-serif"
              >
                ମୋ ସହାୟକ
              </p>
            </div>
          </div>
          <button
            id="chat-close-button"
            class="text-gray-300 hover:text-white text-3xl leading-none"
          >
            &times;
          </button>
        </header>
        <main
          id="chat-body"
          class="flex-1 p-4 overflow-y-auto bg-gray-50 space-y-4"
        >
          <div class="flex justify-start">
            <div
              class="bg-gray-200 text-gray-800 p-3 rounded-lg max-w-xs text-sm"
            >
              Namaskar! I am Mo Sahayak, your AI assistant for Bazaar Odisha.
              How can I help you today?
            </div>
          </div>
        </main>
        <footer class="p-3 border-t bg-white flex-shrink-0">
          <form id="chat-form" class="flex items-center gap-2">
            <input
              type="text"
              id="chat-input"
              placeholder="Ask me anything..."
              class="w-full p-2 border rounded-md focus:ring-2 focus:ring-teal-600 focus:outline-none text-sm"
              autocomplete="off"
            />
            <button
              type="submit"
              class="bg-[#0f766e] hover:bg-[#115e59] text-white p-2 rounded-md"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                viewBox="0 0 20 20"
                fill="currentColor"
              >
                <path
                  fill-rule="evenodd"
                  d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z"
                  clip-rule="evenodd"
                />
              </svg>
            </button>
          </form>
        </footer>
      </div>
      <!-- Chat Button -->
      <button
        id="chat-button"
        class="bg-[#0f766e] hover:bg-[#115e59] text-white rounded-full flex items-center justify-center w-16 h-16 fixed bottom-5 right-5 shadow-lg transform hover:scale-110 transition-transform"
      >
        <img src="images/chat-icon.webp" alt="Chat" class="w-8 h-8" />
      </button>
    </div>

    <script src="data.js"></script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const productGrid = document.getElementById("product-grid");
        const noProductsMessage = document.getElementById(
          "no-products-message"
        );
        const filtersForm = document.getElementById("filters-form");
        const clearFiltersBtn = document.getElementById("clear-filters-btn");
        const priceRange = document.getElementById("price-range");
        const priceValue = document.getElementById("price-value");
        const showFiltersBtn = document.getElementById("show-filters-btn");
        const closeFiltersBtn = document.getElementById("close-filters-btn");
        const filtersSidebar = document.getElementById("filters-sidebar");
        const resultsContainer = document.getElementById("results-container");
        const header = document.querySelector("header");

        const populateFilters = () => {
          const categories = [...new Set(allProducts.map((p) => p.category))];
          document.getElementById(
            "category-filters"
          ).innerHTML = `<label class="font-semibold block mb-2">Category</label><div class="space-y-1">${categories
            .map(
              (cat) =>
                `<label class="flex items-center"><input type="checkbox" name="category" value="${cat}" class="h-4 w-4 rounded border-gray-300 text-[var(--primary-color)] focus:ring-[var(--primary-color)]"><span class="ml-2 text-gray-700 capitalize">${cat}</span></label>`
            )
            .join("")}</div>`;
          const maxPrice = Math.max(...allProducts.map((p) => p.price));
          priceRange.max = maxPrice;
          priceRange.value = maxPrice;
          priceValue.textContent = `₹${maxPrice.toLocaleString()}`;
        };

        const renderProducts = (products) => {
          productGrid.innerHTML = "";
          noProductsMessage.classList.toggle("hidden", products.length > 0);
          productGrid.classList.toggle("hidden", products.length === 0);
          products.forEach((p) => {
            const card = `<div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col"><a href="product-details.html?id=${
              p.id
            }" class="block product-image-container"><img src="${
              p.image
            }" alt="${
              p.name
            }" class="product-image w-full h-56 object-cover"><div class="description-overlay"><p class="font-medium">${p.description.substring(
              0,
              100
            )}...</p></div></a><div class="p-6 flex flex-col flex-grow"><h3 class="text-xl font-semibold">${
              p.name
            }</h3><p class="text-gray-500 mt-1">by ${
              p.shg
            }</p><div class="flex-grow"></div><div class="flex justify-between items-center mt-4"><span class="text-xl font-bold text-gray-800">₹${p.price.toLocaleString()}</span><button class="add-to-cart-btn btn-primary text-sm font-semibold px-4 py-2 rounded-full" data-product-id="${
              p.id
            }">Add to Cart</button></div></div></div>`;
            productGrid.insertAdjacentHTML("beforeend", card);
          });
        };

        const applyFilters = () => {
          const query = document
            .getElementById("search-input")
            .value.toLowerCase();
          const selectedCategories = Array.from(
            document.querySelectorAll('input[name="category"]:checked')
          ).map((cb) => cb.value);
          const maxPrice = parseInt(priceRange.value);
          const filtered = allProducts.filter(
            (p) =>
              (!query ||
                p.name.toLowerCase().includes(query) ||
                p.description.toLowerCase().includes(query)) &&
              (selectedCategories.length === 0 ||
                selectedCategories.includes(p.category)) &&
              p.price <= maxPrice
          );
          renderProducts(filtered);
          if (window.innerWidth < 1024) toggleFilters(false);
        };

        const toggleFilters = (show) => {
          if (show) {
            filtersSidebar.classList.remove("hidden");
            filtersSidebar.classList.add(
              "fixed",
              "inset-0",
              "bg-white",
              "z-50",
              "overflow-y-auto"
            );
            resultsContainer.classList.add("hidden");
            header.classList.add("hidden");
          } else {
            filtersSidebar.classList.add("hidden");
            filtersSidebar.classList.remove(
              "fixed",
              "inset-0",
              "bg-white",
              "z-50",
              "overflow-y-auto"
            );
            resultsContainer.classList.remove("hidden");
            header.classList.remove("hidden");
          }
        };

        const updateCartBadge = () => {
          const badge = document.getElementById("cart-badge");
          if (!badge) return;
          const cart = JSON.parse(sessionStorage.getItem("bazaarCart")) || [];
          const count = cart.reduce((sum, item) => sum + item.quantity, 0);
          badge.textContent = count;
          badge.classList.toggle("active", count > 0);
        };
        const addToCart = (productId) => {
          let cart = JSON.parse(sessionStorage.getItem("bazaarCart")) || [];
          const productData = allProducts.find((p) => p.id === productId);
          if (!productData) return;
          const item = cart.find((i) => i.id === productId);
          if (item) {
            item.quantity++;
          } else {
            cart.push({ ...productData, quantity: 1 });
          }
          sessionStorage.setItem("bazaarCart", JSON.stringify(cart));
          updateCartBadge();
        };

        filtersForm.addEventListener("submit", (e) => {
          e.preventDefault();
          applyFilters();
        });
        clearFiltersBtn.addEventListener("click", () => {
          filtersForm.reset();
          priceRange.value = priceRange.max;
          priceValue.textContent = `₹${parseInt(
            priceRange.max
          ).toLocaleString()}`;
          applyFilters();
        });
        priceRange.addEventListener("input", () => {
          priceValue.textContent = `₹${parseInt(
            priceRange.value
          ).toLocaleString()}`;
        });
        productGrid.addEventListener("click", (e) => {
          const btn = e.target.closest(".add-to-cart-btn");
          if (btn) {
            const id = parseInt(btn.dataset.productId);
            addToCart(id);
            btn.textContent = "Added!";
            btn.style.backgroundColor = "var(--success-color)";
            setTimeout(() => {
              btn.textContent = "Add to Cart";
              btn.style.backgroundColor = "var(--primary-color)";
            }, 2000);
          }
        });

        showFiltersBtn.addEventListener("click", () => toggleFilters(true));
        closeFiltersBtn.addEventListener("click", () => toggleFilters(false));

        document
          .getElementById("mobile-menu-button")
          .addEventListener("click", () =>
            document.getElementById("mobile-menu").classList.toggle("hidden")
          );

        populateFilters();
        renderProducts(allProducts);
        updateCartBadge();
      });
    </script>
    <script src="chatbot.js" defer></script>
  </body>
</html>
